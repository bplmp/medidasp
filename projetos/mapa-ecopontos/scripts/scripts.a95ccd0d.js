"use strict";function handleLocationError(a,b){console.log(a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}function init(){var a=new google.maps.LatLng(-23.5499,-46.63445);map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1});var b=[{featureType:"poi",stylers:[{visibility:"off"}]}];map.setOptions({styles:b}),map.data.loadGeoJson("https://bernardol.carto.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM ecopontos"),map.data.setStyle(function(a){var b=a.getProperty("n_encontr");return 1===b?{icon:"/images/map_marker_32_gray.ebdb323a.png"}:{icon:"/images/map_marker_32.bcd89421.png"}}),map.data.addListener("click",function(a){var b="/#/detalhe?i="+a.feature.f.id;map.panTo(new google.maps.LatLng(a.latLng.lat(),a.latLng.lng())),window.location=b}),map.addListener("click",function(a){"#/"!==document.location.hash&&(window.location.hash="#/")});var c=[],d={path:google.maps.SymbolPath.CIRCLE,fillColor:"#4285f4",fillOpacity:.9,strokeColor:"white",strokeWeight:2,scale:7};navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b={lat:a.coords.latitude,lng:a.coords.longitude};userLoc=b;var e=new google.maps.Marker({map:map,icon:d,title:"Sua localização",position:b}),f=new google.maps.InfoWindow({content:"Sua localização"});c.push(e),e.addListener("click",function(){f.open(map,e)}),map.panTo(b)},function(){handleLocationError(!0,map.getCenter())}):handleLocationError(!1,map.getCenter());var e=document.getElementById("address-search"),f=new google.maps.places.SearchBox(e);map.addListener("bounds_changed",function(){f.setBounds(map.getBounds())}),f.addListener("places_changed",function(){var a=f.getPlaces();0!==a.length&&(c.forEach(function(a){a.setMap(null)}),c=[],a.forEach(function(a){var b=new google.maps.Marker({map:map,icon:d,title:a.name,position:a.geometry.location}),e=new google.maps.InfoWindow({content:a.name});c.push(b),userLoc.lat=a.geometry.location.lat(),userLoc.lng=a.geometry.location.lng(),b.addListener("click",function(){e.open(map,b)}),map.panTo(a.geometry.location),map.setZoom(12)}))})}angular.module("mapaEcopontosApp",["ngAnimate","ngRoute","ngMap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/detalhe",{templateUrl:"views/detalhe.html",controller:"DetalheCtrl",controllerAs:"detalhe"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("mapaEcopontosApp").controller("MainCtrl",["$window",function(a){}]),angular.module("mapaEcopontosApp").controller("AboutCtrl",function(){}),angular.module("mapaEcopontosApp").controller("DetalheCtrl",["filterFilter","$http","$location","$scope","$window",function(a,b,c,d,e,f){var g=c.$$search.i;d.userLoc=e.userLoc,b.get("https://bernardol.carto.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM ecopontos").then(function(b){d.ecopontos=b.data.features,d.ecopontoSelected=a(d.ecopontos,{properties:{id:parseInt(g)}},!0)})}]);var map,userLoc={};angular.module("mapaEcopontosApp").run(["$templateCache",function(a){a.put("views/about.html",'<div class="full-page"> <div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="navbar-header"> <a class="navbar-brand navbar-brand-primary light" href="#/">Ecopontos de São Paulo</a> <a class="navbar-brand navbar-brand-primary pull-right" href="#/about">sobre</a> </div> </div> </div> <div class="sidebar-content"> <div class="text-full"> <p> Os Ecopontos são locais de entrega gratuita de pequenos volumes de entulho, grandes objetos (móveis, poda de árvores etc.) e materiais recicláveis. Eles são administrados pela Prefeitura. <a href="http://www.prefeitura.sp.gov.br/cidade/secretarias/servicos/amlurb/ecopontos/index.php?p=4626">Mais informações sobre ecopontos no site da Prefeitura</a>. </p> <hr> <p> Este mapa foi feito por <a href="http://medidasp.tumblr.com">MedidaSP</a> a partir de <a href="http://www.prefeitura.sp.gov.br/cidade/secretarias/desenvolvimento_urbano/dados_estatisticos/index.php?p=160798">dados da Prefeitura de São Paulo</a>. </p> <p> Se quiser, <a href="https://bernardol.carto.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM ecopontos">baixe os dados aqui</a> em formato GeoJSON. A licensa dos dados é <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Atribuição-NãoComercial-CompartilhaIgual 4.0 Internacional</a>. </p> <p> Não há nenhum tipo de garantia sobre os dados contidos neste site. Eles foram checados mas podem ainda conter erros. </p> <p> Se encontrar erros por favor avise em <a href="mailto:mapa.ecopontos.sp@gmail.com?subject=feedback">mapa.ecopontos.sp@gmail.com</a>. </p> <hr> <p> Map marker por <a href="https://thenounproject.com/search/?q=map+marker&i=5624">Naomi Atkinson</a>. Recycling favicon por <a href="https://thenounproject.com/term/transfer/19960/">Stefan Parnarov</a>. Ambos com licensa Creative Commons. </p> </div> </div> </div>'),a.put("views/detalhe.html",'<div class="sidebar"> <div class="" ng-repeat="eco in ecopontoSelected"> <div class="header"> <div class="navbar navbar-light" role="navigation"> <div class=""> <a class="navbar-brand navbar-brand-light" href="#/">Ecoponto {{eco.properties.nome}}</a> <a class="navbar-brand navbar-brand-light pull-right" href="#/" aria-label="Close">&times;</a> </div> </div> </div> <div class="sidebar-content"> <div ng-if="eco.properties.n_encontr" class="alert alert-danger" role="alert">Atenção: a localização do ecoponto {{eco.properties.nome}} está pouco confiável. Estamos buscando melhorar esses dados e os atualizaremos assim que possível.</div> <div class="row"> <div class="col-xs-3"> <p>Endereço:</p> </div> <div class="col-xs-9"> <p>{{eco.properties.endereco}}<br> </p> </div> </div> <div class="row"> <div class="col-xs-3"> <p>Horário:</p> </div> <div class="col-xs-9"> <p>2<sup>a</sup> a sábabdo: 6h-22h<br> Domingos e feriados: 6h-18h</p> </div> </div> <div class="row"> <div class="col-xs-3"> <p>Telefone:</p> </div> <div class="col-xs-9"> <p><a href="tel:0800 7777 156">0800 7777 156</a><br>(Concessionária INOVA)</p> </div> </div> <a ng-if="userLoc" ng-href="https://maps.google.com?saddr={{userLoc.lat}},{{userLoc.lng}}&daddr={{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}"><button type="button" class="form-control btn btn-purple" name="button">Ver rota</button></a> <a ng-if="!userLoc" ng-href="https://maps.google.com?saddr=Current+Location&daddr={{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}"><button type="button" class="form-control btn btn-purple" name="button">Ver rota</button></a> <map id="sv" style="margin-top:15px" street-view="StreetViewPanorama(document.querySelector(\'map#sv\'), {position:new google.maps.LatLng({{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}), addressControl: false})"> <!-- <ng-map style="margin-top:15px;" zoom="16" center="{{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}" >\n        <marker position="{{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}"\n                icon="/images/map_marker_32.bcd89421.png">\n        </marker>\n        <street-view-panorama\n        click-to-go="true"\n        disable-default-u-i="false"\n        disable-double-click-zoom="true"\n        position="{{eco.geometry.coordinates[1]}},{{eco.geometry.coordinates[0]}}"\n        scrollwheel="false"\n        enable-close-button="true"\n        visible="true">\n        </street-view-panorama>\n      </ng-map> --> </div> </div> </div>'),a.put("views/main.html",'<!-- <ng-map center="[-23.5499, -46.63445]" zoom="12" class="full-height">\n  <map-data\n    set-style="main.styleFunc()"\n    on-mouseup="main.onClick()"\n    load-geo-json="geojson/ecopontos.geojson">\n  </map-data>\n</ng-map> -->')}]);